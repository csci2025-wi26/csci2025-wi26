---
title: "Joins"
subtitle: "Lecture 16"
title-slide-attributes:
  data-background-image: ../vizdata-bg.png
  data-background-size: stretch
  data-slide-number: none
format: revealjs
---

```{r}
#| label: setup
#| message: false
#| echo: false

# load packages
library(tidyverse)
library(countdown)
library(nycflights13)

# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7,        # 7" width
  fig.asp = 0.618,      # the golden ratio
  fig.retina = 3,       # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300             # higher dpi, sharper image
)
```

# Introduction

## Combining Datasets

- Joins are used to combine data from different tables based on a set of common variables ("keys").
- `dplyr` provides a family of join functions.
- We will use data from the `nycflights13` package.

# Keys

## Primary and Foreign Keys

- A **primary key** is a variable (or set of variables) that uniquely identifies each observation in a table.
- A **foreign key** is a variable (or set of variables) in one table that corresponds to a primary key in another table.
- Keys are what link tables together.

# Mutating Joins

## `left_join()`

- `left_join()` is the most commonly used join.
- It returns all rows from the left table (`x`), and all columns from both tables (`x` and `y`).
- Rows in `x` with no match in `y` will have `NA` values in the new columns.

```{r}
#| echo: true
flights2 <- flights |> select(year:day, hour, origin, dest, tailnum, carrier)
flights2 |> left_join(airlines)
```

## Other Mutating Joins

- `inner_join()`: returns only rows that have a match in both tables.
- `right_join()`: returns all rows from the right table.
- `full_join()`: returns all rows from both tables.

# Filtering Joins

## `semi_join()`

- `semi_join()` keeps all rows from the left table (`x`) that have a match in the right table (`y`).
- It does not add any columns from `y`.

```{r}
#| echo: true
top_dest <- flights |>
  count(dest, sort = TRUE) |>
  head(10)

flights |> semi_join(top_dest)
```

## `anti_join()`

- `anti_join()` returns all rows from `x` that do **not** have a match in `y`.
- Useful for finding observations that don't have a match.

```{r}
#| echo: true
flights |>
  anti_join(planes, by = "tailnum") |>
  count(tailnum, sort = TRUE)
```

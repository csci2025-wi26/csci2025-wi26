---
title: "Exploratory Data Analysis"
subtitle: "Lecture 7"
title-slide-attributes:
  data-background-image: ../vizdata-bg.png
  data-background-size: stretch
  data-slide-number: none
format: revealjs
---

```{r}
#| label: setup
#| message: false
#| echo: false

# load packages
library(tidyverse)
library(countdown)
library(patchwork)

# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7,        # 7" width
  fig.asp = 0.618,      # the golden ratio
  fig.retina = 3,       # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300             # higher dpi, sharper image
)
```

# What is EDA?

## Exploratory Data Analysis

EDA is an iterative cycle. You:

1.  Generate questions about your data.
2.  Search for answers by visualizing, transforming, and modelling your data.
3.  Use what you learn to refine your questions and/or generate new questions.

## Fun Quotes

> "There are no routine statistical questions, only questionable statistical routines." — Sir David Cox

. . .

> “Far better an approximate answer to the right question, which is often vague, than an exact answer to the wrong question, which can always be made precise.” — John Tukey


## Guiding Questions

Two main types of questions to ask:

1.  What type of variation occurs within my variables?

2.  What type of covariation occurs between my variables?

## Data: `diamonds`

- We will use the `diamonds` dataset from the `ggplot2` package.
- It contains information about the prices and attributes of almost 54,000 diamonds.
```{r}
glimpse(diamonds)
```

# Variation

## Visualizing Distributions

**Variation** is the tendency of the values of a variable to change from measurement to measurement.

- Every variable has its own pattern of variation, which can reveal interesting information.
- The best way to understand that pattern is to visualize the variable’s distribution.

## Questions

- Which values are the most common? *Why?*

- Which values are rare? *Why?* Does that match your expectations?

- Can you see any unusual patterns? *What might explain them?*

## Recall: Univarite Plots

- Categorical variables: bar charts
- Numerical variables: histograms, boxplots

## Practice

- Let's practice exploring the `diamonds` data set
  - The `binwidth` of a histogram can reveal different patterns.

# Unusual Values

## Outliers

- Outliers are observations that are unusual; points that don’t seem to fit the pattern.
- Sometimes they are data entry errors; other times they are genuinely important.

## Handling Outliers

- If they are data entry errors, try to fix them or remove them.
- If they are genuine, their presence is important information.
- Neither of these conclusions can be made without understanding the context of the data and looking deeply at the observations

## More Practice

- Let's look for outliers in the `diamonds` dataset.
- Let's also work through some of the exercises in the chapter.

# Covariation

## Visualizing Relationships

- **Covariation**: how do two variables change together? What is their relationship?
- Visualizing covariation helps you understand relationships between variables
- You need to think and plan carefully about how to display multiple distributions in a single plot

## Recall: Three general cases

- Categorical + Categorical
  + Boxplots
- Categorical + Numerical
  + Boxplots, jitter plots, faceted histograms
- Numerical + Numerical
  + Scatterplots, jitter plots


## Reordering Categories

- You can reorder the categorical variable to make the plot easier to read.

```{r}
ggplot(diamonds, aes(x = fct_reorder(cut, price, .fun = median), y = price)) +
  geom_boxplot() +
  labs(x = "cut")
```

## Some new plots

- Categorical + Categorical
  + Mosaic plots, count plots, tile plots
- Categorical + Numerical
  + Violin plots, sina plots, ridgeline plots, frequency polygons
- Numerical + Numerical
  + 2D-Histogram/heatmap of counts, hexbin plots


## Practice

- Let's practice exploring covariation in the `diamonds` dataset.
- Techniques to try:
  - Reordering categories
  - New plot types
  - Dealing with overplotting
  - Changing aesthetics (color, size, shape)
  - Filtering and mutating data

# Patterns

## Patterns

- Patterns in your data hint at relationships. If you can spot a pattern, ask yourself:
  - Could this pattern be due to coincidence?
  - How can you describe the relationship implied by the pattern?
  - How strong is the relationship implied by the pattern?
  - What other variables might affect the relationship?
  - Does the relationship change if you look at individual subgroups of the data?
- Models can help you extract the strong patterns and leave the weaker ones.

## Transformations

- Transformations can help you see patterns more clearly.
- Common transformations include:
  - Logarithms
  - Logarithms
  - Logarithms
  - Square roots
  - Logarithms
  - Standardization (z-scores)
  - Logarithms

## The power `emo::ji("man_facepalming")` of logs

- Power law: when $y = ax^k$
  + Taking the log of both sides gives: $\log(y) = \log(a) + k\log(x)$
  + Intuitively: multiplying `x` by a constant multiplies `y` by a constant.
- Power law's are extremely common in nature: 
  + Paretto principle (80/20 rule)
  + City sizes
  + Earthquake magnitudes
  + Wealth distributions
  + Bacteria growth

## Practice

- Let's practice looking for patterns in the `diamonds` dataset.
- Techniques to try:
  - Transformations (logs, square roots)
  - Modeling and residuals

# Summary

## EDA in a nutshell

- EDA is about asking questions and using visualizations to find answers.
- Start by looking at the variation of each variable.
- Then, explore the covariation between variables.
- Use `ggplot2` to create a wide range of plots to help you understand your data.
- **DON'T FORGET TO THINK!**

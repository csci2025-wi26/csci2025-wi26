---
title: "Missing Values"
subtitle: "Lecture 15"
title-slide-attributes:
  data-background-image: ../vizdata-bg.png
  data-background-size: stretch
  data-slide-number: none
format: revealjs
---

```{r}
#| label: setup
#| message: false
#| echo: false

# load packages
library(tidyverse)
library(countdown)

# set theme for ggplot2
ggplot2::theme_set(ggplot2::theme_minimal(base_size = 14))

# set figure parameters for knitr
knitr::opts_chunk$set(
  fig.width = 7,        # 7" width
  fig.asp = 0.618,      # the golden ratio
  fig.retina = 3,       # dpi multiplier for displaying HTML output on retina
  fig.align = "center", # center align figures
  dpi = 300             # higher dpi, sharper image
)
```

# Introduction

## Missing Values

- Real-world data is often messy and contains missing values.
- R represents missing values with `NA`.
- There are explicit and implicit missing values.

# Explicit Missing Values (`NA`)

## `is.na()`

- Most functions will return `NA` if any input is `NA`.
- Use `na.rm = TRUE` to remove `NA`s before computation in functions like `mean()`, `sum()`, etc.

## `tidyr::fill()`

- Fills in missing values using the last known value (last observation carried forward).

```{r}
#| echo: true
df <- tibble(x = c(1, NA, NA, 2, NA), y = c("a", NA, "b", NA, NA))
df |> fill(x, y)
```

## `coalesce()` and `na_if()`

- `dplyr::coalesce()` replaces `NA`s with values from another vector.
- `dplyr::na_if()` replaces a specific value with `NA`.

```{r}
#| echo: true
x <- c(1, 2, NA, 4, -99)
coalesce(x, 0)
na_if(x, -99)
```

# Implicit Missing Values

## Making Implicit `NA`s Explicit

- Implicit missing values are values that are not present in the data.
- For example, if a group has no observations, it won't appear in summaries.

## `tidyr::complete()`

- `complete()` turns implicit missing values into explicit `NA`s by completing the full range of data.

```{r}
#| echo: true
df <- tibble(
  group = c("a", "a", "b"),
  year  = c(2020, 2022, 2021),
  value = 1:3
)
df |> complete(group, year)
```

# `NaN`

## Not a Number (`NaN`)

- `NaN` ("Not a Number") is a special numeric value that can arise from invalid mathematical operations, like `0/0`.
- `is.nan()` tests for `NaN`.
- `NaN` is also considered `NA`, so `is.na(NaN)` is `TRUE`.

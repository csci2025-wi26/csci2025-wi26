{
  "hash": "40ee8984d2d90e70f580614a8d8f6b7a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Joins\"\nsubtitle: \"Lecture 16\"\ntitle-slide-attributes:\n  data-background-image: ../vizdata-bg.png\n  data-background-size: stretch\n  data-slide-number: none\nformat: revealjs\n---\n\n\n::: {.cell}\n\n:::\n\n\n# Introduction\n\n## Combining Datasets\n\n- Joins are used to combine data from different tables based on a set of common variables (\"keys\").\n- `dplyr` provides a family of join functions.\n- We will use data from the `nycflights13` package.\n\n# Keys\n\n## Primary and Foreign Keys\n\n- A **primary key** is a variable (or set of variables) that uniquely identifies each observation in a table.\n- A **foreign key** is a variable (or set of variables) in one table that corresponds to a primary key in another table.\n- Keys are what link tables together.\n\n## Dataset 1: `flights`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglimpse(flights)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 336,776\nColumns: 19\n$ year           <int> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2…\n$ month          <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ day            <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…\n$ dep_time       <int> 517, 533, 542, 544, 554, 554, 555, 557, 557, 558, 558, …\n$ sched_dep_time <int> 515, 529, 540, 545, 600, 558, 600, 600, 600, 600, 600, …\n$ dep_delay      <dbl> 2, 4, 2, -1, -6, -4, -5, -3, -3, -2, -2, -2, -2, -2, -1…\n$ arr_time       <int> 830, 850, 923, 1004, 812, 740, 913, 709, 838, 753, 849,…\n$ sched_arr_time <int> 819, 830, 850, 1022, 837, 728, 854, 723, 846, 745, 851,…\n$ arr_delay      <dbl> 11, 20, 33, -18, -25, 12, 19, -14, -8, 8, -2, -3, 7, -1…\n$ carrier        <chr> \"UA\", \"UA\", \"AA\", \"B6\", \"DL\", \"UA\", \"B6\", \"EV\", \"B6\", \"…\n$ flight         <int> 1545, 1714, 1141, 725, 461, 1696, 507, 5708, 79, 301, 4…\n$ tailnum        <chr> \"N14228\", \"N24211\", \"N619AA\", \"N804JB\", \"N668DN\", \"N394…\n$ origin         <chr> \"EWR\", \"LGA\", \"JFK\", \"JFK\", \"LGA\", \"EWR\", \"EWR\", \"LGA\",…\n$ dest           <chr> \"IAH\", \"IAH\", \"MIA\", \"BQN\", \"ATL\", \"ORD\", \"FLL\", \"IAD\",…\n$ air_time       <dbl> 227, 227, 160, 183, 116, 150, 158, 53, 140, 138, 149, 1…\n$ distance       <dbl> 1400, 1416, 1089, 1576, 762, 719, 1065, 229, 944, 733, …\n$ hour           <dbl> 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6…\n$ minute         <dbl> 15, 29, 40, 45, 0, 58, 0, 0, 0, 0, 0, 0, 0, 0, 0, 59, 0…\n$ time_hour      <dttm> 2013-01-01 05:00:00, 2013-01-01 05:00:00, 2013-01-01 0…\n```\n\n\n:::\n:::\n\n\n## Dataset 2: `airlines`\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nglimpse(airlines)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 16\nColumns: 2\n$ carrier <chr> \"9E\", \"AA\", \"AS\", \"B6\", \"DL\", \"EV\", \"F9\", \"FL\", \"HA\", \"MQ\", \"O…\n$ name    <chr> \"Endeavor Air Inc.\", \"American Airlines Inc.\", \"Alaska Airline…\n```\n\n\n:::\n:::\n\n\n# Mutating Joins\n\n## `left_join()`\n\n- `left_join()` is the most commonly used join.\n- It returns all rows from the left table (`x`), and all columns from both tables (`x` and `y`).\n- Rows in `x` with no match in `y` will have `NA` values in the new columns.\n- Rows in `y` with no match in `x` are ignored.\n- Rows in `y` that match multiple rows in `x` will result in duplicated rows in the output (and vice versa).\n\n## Example\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nflights2 <- flights |> select(year:day, hour, origin, dest, tailnum, carrier)\nflights2 |> left_join(airlines, by = \"carrier\") |> glimpse()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 336,776\nColumns: 9\n$ year    <int> 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 2013, 20…\n$ month   <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ day     <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1,…\n$ hour    <dbl> 5, 5, 5, 5, 6, 5, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6, 6, 6,…\n$ origin  <chr> \"EWR\", \"LGA\", \"JFK\", \"JFK\", \"LGA\", \"EWR\", \"EWR\", \"LGA\", \"JFK\",…\n$ dest    <chr> \"IAH\", \"IAH\", \"MIA\", \"BQN\", \"ATL\", \"ORD\", \"FLL\", \"IAD\", \"MCO\",…\n$ tailnum <chr> \"N14228\", \"N24211\", \"N619AA\", \"N804JB\", \"N668DN\", \"N39463\", \"N…\n$ carrier <chr> \"UA\", \"UA\", \"AA\", \"B6\", \"DL\", \"UA\", \"B6\", \"EV\", \"B6\", \"AA\", \"B…\n$ name    <chr> \"United Air Lines Inc.\", \"United Air Lines Inc.\", \"American Ai…\n```\n\n\n:::\n:::\n\n\n## Other Mutating Joins\n\n- `inner_join()`: returns only rows that have a match in both tables.\n- `right_join()`: returns all rows from the right table.\n- `full_join()`: returns all rows from both tables.\n\n# Filtering Joins\n\n## `semi_join()`\n\n- `semi_join()` keeps all rows from the left table (`x`) that have a match in the right table (`y`).\n- It does not add any columns from `y`.\n\n## Example\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ntop_dest <- flights |>\n  count(dest, sort = TRUE) |>\n  head(10)\n\nflights |> semi_join(top_dest)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(dest)`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 141,145 × 19\n    year month   day dep_time sched_dep_time dep_delay arr_time sched_arr_time\n   <int> <int> <int>    <int>          <int>     <dbl>    <int>          <int>\n 1  2013     1     1      542            540         2      923            850\n 2  2013     1     1      554            600        -6      812            837\n 3  2013     1     1      554            558        -4      740            728\n 4  2013     1     1      555            600        -5      913            854\n 5  2013     1     1      557            600        -3      838            846\n 6  2013     1     1      558            600        -2      753            745\n 7  2013     1     1      558            600        -2      924            917\n 8  2013     1     1      558            600        -2      923            937\n 9  2013     1     1      559            559         0      702            706\n10  2013     1     1      600            600         0      851            858\n# ℹ 141,135 more rows\n# ℹ 11 more variables: arr_delay <dbl>, carrier <chr>, flight <int>,\n#   tailnum <chr>, origin <chr>, dest <chr>, air_time <dbl>, distance <dbl>,\n#   hour <dbl>, minute <dbl>, time_hour <dttm>\n```\n\n\n:::\n:::\n\n\n## `anti_join()`\n\n- `anti_join()` returns all rows from `x` that do **not** have a match in `y`.\n- Useful for finding observations that don't have a match.\n\n## Example\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nflights |>\n  anti_join(planes, by = \"tailnum\") |>\n  count(tailnum, sort = TRUE)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 722 × 2\n   tailnum     n\n   <chr>   <int>\n 1 <NA>     2512\n 2 N725MQ    575\n 3 N722MQ    513\n 4 N723MQ    507\n 5 N713MQ    483\n 6 N735MQ    396\n 7 N0EGMQ    371\n 8 N534MQ    364\n 9 N542MQ    363\n10 N531MQ    349\n# ℹ 712 more rows\n```\n\n\n:::\n:::\n\n\n\n## Practice!\n\nLet's practice joins!\n",
    "supporting": [
      "16-joins_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "2454de88595a217d2b95262cc214a19d",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Data Tidying\nsubtitle: \"From messy to tidy\"\ntitle-slide-attributes:\n  data-background-image: ../vizdata-bg.png\n  data-background-size: stretch\n  data-slide-number: none\nformat: revealjs\n---\n\n## This lesson\n\n-   Define \"tidy data\"\n-   Learn how to use `tidyr` to make data tidy\n    -   `pivot_longer()` for lengthening data\n    -   `pivot_wider()` for widening data\n\n## What is tidy data?\n\nTidy data is a consistent way of structuring datasets that makes them easier to work with. A dataset is tidy if it follows three rules:\n\n1.  **Each variable has its own column.**\n2.  **Each observation has its own row.**\n3.  **Each value has its own cell.**\n\nThis structure is a standard in the `tidyverse`.\n\n## Setup {.smaller}\n\nWe will be using functions from the `tidyr` package, which is part of the `tidyverse`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# load packages\nlibrary(tidyverse)\n```\n:::\n\n\n## Lengthening data with `pivot_longer()` {.smaller}\n\n-  **Wide Format**: column names are actually values of a variable:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrelig_income |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 11\n  religion  `<$10k` `$10-20k` `$20-30k` `$30-40k` `$40-50k` `$50-75k` `$75-100k`\n  <chr>       <dbl>     <dbl>     <dbl>     <dbl>     <dbl>     <dbl>      <dbl>\n1 Agnostic       27        34        60        81        76       137        122\n2 Atheist        12        27        37        52        35        70         73\n3 Buddhist       27        21        30        34        33        58         62\n4 Catholic      418       617       732       670       638      1116        949\n5 Don’t kn…      15        14        15        11        10        35         21\n6 Evangeli…     575       869      1064       982       881      1486        949\n# ℹ 3 more variables: `$100-150k` <dbl>, `>150k` <dbl>,\n#   `Don't know/refused` <dbl>\n```\n\n\n:::\n:::\n\n\nThis is not tidy. The income brackets are variable names, not a variable.\n\n## Using `pivot_longer()` {.smaller}\n\n:::: columns\n::: column\n-   Goal: transform this so we have three columns: `religion`, `income`, and `count`.\n-   Use `pivot_longer()` to do this.\n\n\n::: {.cell ouput='{}'}\n\n```{.r .cell-code}\ntidy_relig_income <- relig_income |> \n  pivot_longer(\n    cols = !religion, \n    names_to = \"income\", \n    values_to = \"count\"\n  )\n\ntidy_relig_income |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  religion income  count\n  <chr>    <chr>   <dbl>\n1 Agnostic <$10k      27\n2 Agnostic $10-20k    34\n3 Agnostic $20-30k    60\n4 Agnostic $30-40k    81\n5 Agnostic $40-50k    76\n6 Agnostic $50-75k   137\n```\n\n\n:::\n:::\n\n:::\n\n::: column\n-   `cols`: The columns to pivot into longer format. `!religion` means all columns *except* `religion`.\n-   `names_to`: The name of the new column that will contain the names of the original columns.\n-   `values_to`: The name of the new column that will contain the values from the original columns.\n:::\n::::\n\n\n\n## Another `pivot_longer()` example: `billboard`\n\nThe `billboard` dataset has chart rankings for 2000.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 79\n  artist      track date.entered   wk1   wk2   wk3   wk4   wk5   wk6   wk7   wk8\n  <chr>       <chr> <date>       <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>\n1 2 Pac       Baby… 2000-02-26      87    82    72    77    87    94    99    NA\n2 2Ge+her     The … 2000-09-02      91    87    92    NA    NA    NA    NA    NA\n3 3 Doors Do… Kryp… 2000-04-08      81    70    68    67    66    57    54    53\n4 3 Doors Do… Loser 2000-10-21      76    76    72    69    67    65    55    59\n5 504 Boyz    Wobb… 2000-04-15      57    34    25    17    17    31    36    49\n6 98^0        Give… 2000-08-19      51    39    34    26    26    19     2     2\n# ℹ 68 more variables: wk9 <dbl>, wk10 <dbl>, wk11 <dbl>, wk12 <dbl>,\n#   wk13 <dbl>, wk14 <dbl>, wk15 <dbl>, wk16 <dbl>, wk17 <dbl>, wk18 <dbl>,\n#   wk19 <dbl>, wk20 <dbl>, wk21 <dbl>, wk22 <dbl>, wk23 <dbl>, wk24 <dbl>,\n#   wk25 <dbl>, wk26 <dbl>, wk27 <dbl>, wk28 <dbl>, wk29 <dbl>, wk30 <dbl>,\n#   wk31 <dbl>, wk32 <dbl>, wk33 <dbl>, wk34 <dbl>, wk35 <dbl>, wk36 <dbl>,\n#   wk37 <dbl>, wk38 <dbl>, wk39 <dbl>, wk40 <dbl>, wk41 <dbl>, wk42 <dbl>,\n#   wk43 <dbl>, wk44 <dbl>, wk45 <dbl>, wk46 <dbl>, wk47 <dbl>, wk48 <dbl>, …\n```\n\n\n:::\n:::\n\n\nThe `wk1`, `wk2`, ... columns are values of a \"week\" variable.\n\n## Tidying `billboard`\n\n:::: columns\n::: column\n\n::: {.cell}\n\n```{.r .cell-code}\nbillboard |>\n  pivot_longer(\n    cols = starts_with(\"wk\"),\n    names_to = \"week\",\n    values_to = \"rank\",\n    values_drop_na = TRUE\n  ) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 5\n  artist track                   date.entered week   rank\n  <chr>  <chr>                   <date>       <chr> <dbl>\n1 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk1      87\n2 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk2      82\n3 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk3      72\n4 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk4      77\n5 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk5      87\n6 2 Pac  Baby Don't Cry (Keep... 2000-02-26   wk6      94\n```\n\n\n:::\n:::\n\n:::\n\n::: column\n- We use `starts_with(\"wk\")` to select the columns to pivot.\n- `values_drop_na = TRUE` removes rows where the rank is `NA`.\n:::\n::::\n\n\n\n## Widening data with `pivot_wider()` {.smaller}\n\n`pivot_wider()` is the opposite of `pivot_longer()`. It's used when an observation is scattered across multiple rows.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_encounters |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 3\n  fish  station  seen\n  <fct> <fct>   <int>\n1 4842  Release     1\n2 4842  I80_1       1\n3 4842  Lisbon      1\n4 4842  Rstr        1\n5 4842  Base_TD     1\n6 4842  BCE         1\n```\n\n\n:::\n:::\n\n\n-  One observation = one fishing station\n-  `fish_encounters` has two rows for each station: one for when a fish was seen and one for when it wasn't\n-  `station` column contains variable names\n-  `seen` column contains(`0`/`1`) values\n\n## Using `pivot_wider()` {.smaller}\n\nGoal: one row per station, with columns indicating whether fish was seen or not.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_encounters |>\n  pivot_wider(\n    names_from = station,\n    values_from = seen\n  ) |> \n    head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 12\n  fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE   MAW\n  <fct>   <int> <int>  <int> <int>   <int> <int> <int> <int> <int> <int> <int>\n1 4842        1     1      1     1       1     1     1     1     1     1     1\n2 4843        1     1      1     1       1     1     1     1     1     1     1\n3 4844        1     1      1     1       1     1     1     1     1     1     1\n4 4845        1     1      1     1       1    NA    NA    NA    NA    NA    NA\n5 4847        1     1      1    NA      NA    NA    NA    NA    NA    NA    NA\n6 4848        1     1      1     1      NA    NA    NA    NA    NA    NA    NA\n```\n\n\n:::\n:::\n\n\nProblem: `NA` values where there shoiuld be zeros, can fix this with `values_fill`.\n\n\n## Using `pivot_wider()` with `values_fill` {.smaller}\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfish_encounters |>\n  pivot_wider(\n    names_from = station,\n    values_from = seen,\n    values_fill = 0\n  ) |> \n    head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 12\n  fish  Release I80_1 Lisbon  Rstr Base_TD   BCE   BCW  BCE2  BCW2   MAE   MAW\n  <fct>   <int> <int>  <int> <int>   <int> <int> <int> <int> <int> <int> <int>\n1 4842        1     1      1     1       1     1     1     1     1     1     1\n2 4843        1     1      1     1       1     1     1     1     1     1     1\n3 4844        1     1      1     1       1     1     1     1     1     1     1\n4 4845        1     1      1     1       1     0     0     0     0     0     0\n5 4847        1     1      1     0       0     0     0     0     0     0     0\n6 4848        1     1      1     1       0     0     0     0     0     0     0\n```\n\n\n:::\n:::\n\n- `names_from`: The column to get the new column names from.\n- `values_from`: The column to get the cell values from.\n- `values_fill`: A value to replace `NA`s with.\n\n## Summary\n\n-   **Tidy data** is a standard format that makes data analysis easier.\n-   Use `pivot_longer()` when your column names are actually values of a variable (to make data longer and narrower).\n-   Use `pivot_wider()` when an observation is scattered across multiple rows (to make data wider and shorter).\n-   You will often need to use `pivot_longer()` and `pivot_wider()` when preparing data for plotting\n\nThese two functions are the foundation of data tidying in R.",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}
{
  "hash": "b26a58373e5e7611fd6dbeca426523ff",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Factors\"\nsubtitle: \"Lecture 13\"\ntitle-slide-attributes:\n  data-background-image: ../vizdata-bg.png\n  data-background-size: stretch\n  data-slide-number: none\nformat: revealjs\n---\n\n\n::: {.cell}\n\n:::\n\n\n# Introduction\n\n## Categorical Data and Factors\n\n- Factors are R's data structure for categorical variables.\n- The `forcats` package (part of `tidyverse`) provides a suite of tools for working with factors.\n- Useful for reordering and relabeling for better visualizations.\n\n# Creating Factors\n\n## `factor()` and `fct()`\n\n- Create factors from a character vector.\n- `levels()` shows the categories of the factor.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nx <- c(\"Male\", \"Female\", \"Female\", \"Male\")\nf <- factor(x)\nf\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] Male   Female Female Male  \nLevels: Female Male\n```\n\n\n:::\n\n```{.r .cell-code}\nlevels(f)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Female\" \"Male\"  \n```\n\n\n:::\n:::\n\n\n## `gss_cat` dataset\n\n- We'll use the `gss_cat` dataset, which contains data from the General Social Survey, for examples.\n\n# Modifying Factor Order\n\n## `fct_reorder()`\n\n- Reorders a factor by another variable, useful for plots.\n- For example, ordering bars in a bar chart.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngss_cat |>\n  filter(rincome != \"Not applicable\") |>\n  group_by(rincome) |>\n  summarize(age = mean(age, na.rm = TRUE)) |>\n  mutate(rincome = fct_reorder(rincome, age)) |>\n  ggplot(aes(x = age, y = rincome)) +\n  geom_col()\n```\n:::\n\n\n## Example\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\ngss_cat |>\n  filter(rincome != \"Not applicable\") |>\n  group_by(rincome) |>\n  summarize(age = mean(age, na.rm = TRUE)) |>\n  mutate(rincome = fct_reorder(rincome, age)) |>\n  ggplot(aes(x = age, y = rincome)) +\n  geom_col()\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-3-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## `fct_infreq()`\n\n- Reorders a factor by the frequency of its values.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngss_cat |>\n  count(race) |>\n  mutate(race = fct_infreq(race)) |> \n  ggplot(aes(x = n, y = race)) +\n  geom_col()\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-4-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## `fct_relevel()`\n\n- Manually move levels to the front.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\np1 <- gss_cat |> \n  ggplot(aes(x = partyid)) +\n  geom_bar()\n\np2 <- gss_cat |> \n  mutate(partyid = fct_relevel(partyid, \"Independent\")) |> \n  ggplot(aes(x = partyid)) +\n  geom_bar()\n\np1 + p2\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-5-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## Practice!\n\nLet's do some practice!\n\n# Modifying Factor Levels\n\n## `fct_recode()`\n\n- Changes the names of factor levels.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngss_cat |>\n  mutate(partyid = fct_recode(partyid,\n    \"Republican, strong\"    = \"Strong republican\",\n    \"Republican, weak\"      = \"Not str republican\",\n    \"Independent, near rep\" = \"Ind,near rep\",\n    \"Independent, near dem\" = \"Ind,near dem\",\n    \"Democrat, weak\"        = \"Not str democrat\",\n    \"Democrat, strong\"      = \"Strong democrat\"\n  )) |>\n  ggplot(aes(y = partyid)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-6-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## `fct_collapse()`\n\n- Combines several levels into one.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngss_cat |>\n  mutate(partyid = fct_collapse(partyid,\n    other = c(\"No answer\", \"Don't know\", \"Other party\"),\n    rep = c(\"Strong republican\", \"Not str republican\"),\n    ind = c(\"Ind,near rep\", \"Independent\", \"Ind,near dem\"),\n    dem = c(\"Not str democrat\", \"Strong democrat\")\n  )) |>\n  ggplot(aes(y = partyid)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-7-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## `fct_lump_*()`\n\n- `fct_lump_n()` and `fct_lump_prop()` lump together the least/most frequent levels into an \"Other\" category.\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ngss_cat |>\n  mutate(relig = fct_lump_n(relig, n = 5)) |>\n  ggplot(aes(y = relig)) +\n  geom_bar()\n```\n\n::: {.cell-output-display}\n![](13-factors_files/figure-revealjs/unnamed-chunk-8-1.png){fig-align='center' width=2100}\n:::\n:::\n\n\n## Practice!\n\nLet's do some practice!\n",
    "supporting": [
      "13-factors_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-after-body": [
        "\n<script>\n  // htmlwidgets need to know to resize themselves when slides are shown/hidden.\n  // Fire the \"slideenter\" event (handled by htmlwidgets.js) when the current\n  // slide changes (different for each slide format).\n  (function () {\n    // dispatch for htmlwidgets\n    function fireSlideEnter() {\n      const event = window.document.createEvent(\"Event\");\n      event.initEvent(\"slideenter\", true, true);\n      window.document.dispatchEvent(event);\n    }\n\n    function fireSlideChanged(previousSlide, currentSlide) {\n      fireSlideEnter();\n\n      // dispatch for shiny\n      if (window.jQuery) {\n        if (previousSlide) {\n          window.jQuery(previousSlide).trigger(\"hidden\");\n        }\n        if (currentSlide) {\n          window.jQuery(currentSlide).trigger(\"shown\");\n        }\n      }\n    }\n\n    // hookup for slidy\n    if (window.w3c_slidy) {\n      window.w3c_slidy.add_observer(function (slide_num) {\n        // slide_num starts at position 1\n        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);\n      });\n    }\n\n  })();\n</script>\n\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}